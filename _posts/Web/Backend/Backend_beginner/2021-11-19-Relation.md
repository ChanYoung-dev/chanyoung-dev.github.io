---
permalink: /Web/Backend/Backend_beginner/Relation/
title: "Relationê³¼ Join"
toc: true
categories:
  - WebğŸ®Backend
comments: true
sidebar:
  - title: "WebğŸ®"
  - nav: "Web-menu"
tags:
  - Backend_beginner
---

## selected_related
ë‹¤ìŒê³¼ ê°™ì€ ê´€ê³„ì¼ ë•Œ,  

selectí•  ëª¨ë¸ ê°ì²´ê°€ ì—­ì°¸ì¡°í•˜ëŠ” single object(one to one, many to one)  
ì •ì°¸ì¡° ì™¸ë˜í‚¤(foreign key)
{: .notice--primary}

Joinëœ í…Œì´ë¸”ì„ ë¶ˆëŸ¬ë“¤ì´ëŠ” ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ì—¬ í•œë²ˆì˜ ì¿¼ë¦¬ë§Œìœ¼ë¡œ ëª¨ë¸ì— ì°¸ì¡°ëœ ëª¨ë¸ë“¤ì˜ í•„ë“œë¥¼ ì½ì„ ìˆ˜ ìˆë‹¤.  

### ì˜ˆì‹œ

[ì¥ê³ ë¬¸ì„œ](https://docs.djangoproject.com/ko/3.2/ref/models/querysets/#select-related)ì—ì„œ ì˜ˆì‹œë¥¼ í™•ì¸í•´ë³´ì
```python
from django.db import models

class City(models.Model):
    # ...
    pass

class Person(models.Model):
    # ...
    hometown = models.ForeignKey(
        City,
        on_delete=models.SET_NULL,
        blank=True,
        null=True,
    )

class Book(models.Model):
    # ...
    author = models.ForeignKey(Person, on_delete=models.CASCADE)
```
Book <- Person <- Cityì˜ ì°¸ì¡°ê´€ê³„ê°€ ìˆë‹¤.

```python
# Hits the database with joins to the author and hometown tables.
b = Book.objects.select_related('author__hometown').get(id=4)
p = b.author         # Doesn't hit the database.
c = p.hometown       # Doesn't hit the database.

# Without select_related()...
b = Book.objects.get(id=4)  # Hits the database.
p = b.author         # Hits the database.
c = p.hometown       # Hits the database.
```
- selected_relatedë¥¼ ì‚¬ìš©í•˜ì§€ì•Šì„ë•ŒëŠ” ì´ ì„¸ë²ˆì˜ ì¿¼ë¦¬ ê°¯ìˆ˜ê°€ ìˆë‹¤.(ì„¸ë²ˆ ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼)  
- select_relatedëŠ” ì´ í•œë²ˆì˜ ì¿¼ë¦¬(JOIN)ë¥¼ ë¶€ë¦„ìœ¼ë¡œì¨ ì°¸ì¡°ê´€ê³„ì— ìˆëŠ” í•„ë“œë“¤ì„ ë¶ˆëŸ¬ ì½ì„ ìˆ˜ìˆë‹¤.   
- ì¿¼ë¦¬ëŠ” ë³µì¡í•´ì§€ì§€ë§Œ ë¶ˆëŸ¬ì˜¨ í•„ë“œë°ì´í„°ê°’ë“¤ì´ ìºì‹œì— ë‚¨ì•„ìˆê¸°ë•Œë¬¸ì— DBì˜ ì ‘ê·¼ì„ ì¤„ì¼ ìˆ˜ ìˆë‹¤.


### ì‘ìš©
[djangopractice](http://djangopractice.world/third/list/)ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ëª¨ë¸ ë¦´ë ˆì´ì…˜ì´ ìˆë‹¤. Many(review) to one(restaruant)ê´€ê³„ì´ë‹¤.
```python
class Restaurant(models.Model): # Restaurant ë¼ëŠ” ìƒì ì„ ë‚˜íƒ€ë‚´ëŠ” ëª¨ë¸ì„ ì •ì˜
    name = models.CharField(max_length=30)  # ì´ë¦„
    address = models.CharField(max_length=200)  # ì£¼ì†Œ

    ...

class Review(models.Model):
    point = models.IntegerField(default=0)
    comment = models.CharField(max_length=500)

    # ì‹ë‹¹ ëª¨ë¸ê³¼ì˜ ë¦´ë ˆì´ì…˜ ì •ì˜,
    # on_delete CASCADEë¡œ ì§€ì •í•˜ë©´ ì‹ë‹¹ì´ ì‚­ì œë˜ë©´ ê°™ì´ ì‚­ì œëœë‹¤.
    restaurant = models.ForeignKey(Restaurant, on_delete=models.CASCADE)

    ...
```

- - -
ì´ëŸ¬í•œ ë¦´ë ˆì´ì…˜ ê´€ê³„(Many to one)ì—ì„œ í•œë²ˆì˜ í˜¸ì¶œë§Œì„ ì‚¬ìš©í•˜ì—¬ Restaurantê³¼ ê´€ë ¨ëœ reviewë°ì´í„°ë¥¼ ë¶ˆëŸ¬ë“¤ì¼ìˆ˜ ìˆë‹¤.
```python
def review_list(request):
    #reviews = Review.objects.all().order_by('-created_at')
    reviews = Review.objects.select_related().all().order_by('-created_at')
    paginator = Paginator(reviews, 10)  # í•œ í˜ì´ì§€ì— 10ê°œì”© í‘œì‹œ

    page = request.GET.get('page')  # query paramsì—ì„œ page ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
    items = paginator.get_page(page)  # í•´ë‹¹ í˜ì´ì§€ì˜ ì•„ì´í…œìœ¼ë¡œ í•„í„°ë§

    context = {
        'reviews': items
    }
    return render(request, 'third/review_list.html', context)
```